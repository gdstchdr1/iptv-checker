name: IPTV Jade & Phoenix Info Extractor

on:
  schedule:
    - cron: "0 8 * * *"  # æ¯ 6 å°æ—¶è¿è¡Œä¸€æ¬¡
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  check-iptv:
    runs-on: ubuntu-latest

    steps:
      - name: æ‹‰å–ä»“åº“ä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # ç¡®ä¿å¯ä»¥è·å–å®Œæ•´çš„ Git å†å²

      - name: å®‰è£… Curl
        run: sudo apt update && sudo apt install -y curl

      - name: è¿è¡Œ IPTV é¢‘é“æå–è„šæœ¬
        run: bash iptv.sh

      - name: é…ç½® Git ç”¨æˆ·ä¿¡æ¯
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"

      - name: è®¤è¯ GitHub Token å¹¶æ¨é€ä»£ç 
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git
          git fetch origin
          git checkout -B gh-pages
          git pull --rebase origin gh-pages  # ğŸ”¥ å…³é”®ï¼šæ‹‰å–è¿œç¨‹æœ€æ–°ä»£ç å¹¶åˆå¹¶
          
          mv tv_selected.m3u tv_selected_new.m3u  # å…ˆæ”¹åï¼Œé¿å… cp å¤åˆ¶é”™è¯¯
          mv tv_selected_new.m3u tv_selected.m3u  # å†æ”¹å›åŸå
          
          git add tv_selected.m3u
          git diff --staged --quiet || git commit -m "æ›´æ–°ç¿¡ç¿ å° & å‡¤å‡°èµ„è®¯é¢‘é“ $(date '+%Y-%m-%d %H:%M:%S')"
          git push origin gh-pages  # âœ… ç¡®ä¿ push ä¸ä¼šå› ä¸º "non-fast-forward" å¤±è´¥
